
Ext.ux.ToolbarDroppable=Ext.extend(Object,{constructor:function(config){Ext.apply(this,config,{});},init:function(toolbar){this.toolbar=toolbar;this.toolbar.on({scope:this,render:this.createDropTarget});},createDropTarget:function(){this.dropTarget=new Ext.dd.DropTarget(this.toolbar.getEl(),{notifyOver:this.notifyOver.createDelegate(this),notifyDrop:this.notifyDrop.createDelegate(this)});},addDDGroup:function(ddGroup){this.dropTarget.addToGroup(ddGroup);},calculateEntryIndex:function(e){var entryIndex=0,toolbar=this.toolbar,items=toolbar.items.items,count=items.length,xTotal=toolbar.getEl().getXY()[0],xHover=e.getXY()[0]-xTotal;for(var index=0;index<count;index++){var item=items[index],width=item.getEl().getWidth(),midpoint=xTotal+width/2;xTotal+=width;if(xHover<midpoint){entryIndex=index;break;}else{entryIndex=index+1;}}
return entryIndex;},canDrop:function(data){return true;},notifyOver:function(dragSource,event,data){return this.canDrop.apply(this,arguments)?this.dropTarget.dropAllowed:this.dropTarget.dropNotAllowed;},notifyDrop:function(dragSource,event,data){var canAdd=this.canDrop(dragSource,event,data),tbar=this.toolbar;if(canAdd){var entryIndex=this.calculateEntryIndex(event);tbar.insert(entryIndex,this.createItem(data));tbar.doLayout();this.afterLayout();}
return canAdd;},createItem:function(data){throw new Error("The createItem method must be implemented in the ToolbarDroppable plugin");},afterLayout:Ext.emptyFn});