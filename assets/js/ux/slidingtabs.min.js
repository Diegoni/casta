
Ext.ux.SlidingTabPanel=Ext.extend(Ext.TabPanel,{initTab:function(item,index){Ext.ux.SlidingTabPanel.superclass.initTab.call(this,item,index);var p=this.getTemplateArgs(item);if(!this.slidingTabsID)
this.slidingTabsID=Ext.id();new Ext.ux.DDSlidingTab(p,this.slidingTabsID,{tabpanel:this});}});Ext.ux.DDSlidingTab=Ext.extend(Ext.dd.DDProxy,{constructor:function(){Ext.ux.DDSlidingTab.superclass.constructor.apply(this,arguments);this.setYConstraint(0,0,0);this.tabpanel=this.config.tabpanel;this.slideDuration=this.tabpanel.slideDuration;if(!this.slideDuration)
this.slideDuration=.1;},handleMouseDown:function(e,oDD){if(this.primaryButtonOnly&&e.button!=0)
return;if(this.isLocked())
return;this.DDM.refreshCache(this.groups);var pt=new Ext.lib.Point(Ext.lib.Event.getPageX(e),Ext.lib.Event.getPageY(e));if(!this.hasOuterHandles&&!this.DDM.isOverTarget(pt,this)){}
else{if(this.clickValidator(e)){this.setStartPosition();this.b4MouseDown(e);this.onMouseDown(e);this.DDM.handleMouseDown(e,this);}}},startDrag:function(x,y){Ext.dd.DDM.useCache=false;Ext.dd.DDM.mode=1;this.proxyWrapper=Ext.get(this.getDragEl());this.proxyWrapper.update();this.proxyWrapper.applyStyles('z-index:1001;border:0 none;');this.proxyWrapper.addClass('tab-proxy');this.stripWrap=this.proxyWrapper.insertHtml('afterBegin','<div class="x-tab-strip x-tab-strip-top"></div>',true);this.dragEl=this.stripWrap.insertHtml('afterBegin','<div></div>',true);this.tab=Ext.get(this.getEl());this.tab.applyStyles('visibility:hidden;');this.dragEl.insertHtml('afterBegin',this.tab.dom.innerHTML,false);this.dragEl.dom.className=this.tab.dom.className;var panelWidth=this.tabpanel.el.getWidth();var panelX=this.tabpanel.el.getX();var tabX=this.tab.getX();var tabWidth=this.tab.getWidth();var left=tabX-panelX;var right=panelX+panelWidth-tabX-tabWidth;this.resetConstraints();this.setXConstraint(left,right);},onDragOver:function(e,targetArr){e.stopEvent();var target=Ext.get(targetArr[0].id);var targetWidth=target.getWidth();var targetX=target.getX();var targetMiddle=targetX+(targetWidth/2);var elX=this.tab.getX();var dragX=this.proxyWrapper.getX();var dragW=this.proxyWrapper.getWidth();if(dragX<targetX&&((dragX+dragW)>targetMiddle)){if(target.next()!=this.tab){target.applyStyles('visibility:hidden;');this.tab.insertAfter(target);this.targetProxy=this.createSliderProxy(targetX,target);if(!this.targetProxy.hasActiveFx())
this.animateSliderProxy(target,this.targetProxy,elX);}}
if(dragX>targetX&&(dragX<targetMiddle)){if(this.tab.next()!=target){target.applyStyles('visibility:hidden;');this.tab.insertBefore(target);this.targetProxy=this.createSliderProxy(targetX,target);if(!this.targetProxy.hasActiveFx())
this.animateSliderProxy(target,this.targetProxy,elX);}}},animateSliderProxy:function(target,targetProxy,elX){targetProxy.shift({x:elX,easing:'easeOut',duration:this.slideDuration,callback:function(){targetProxy.remove();target.applyStyles('visibility:visible;');},scope:this});},createSliderProxy:function(targetX,target){var sliderWrapperEl=Ext.getBody().insertHtml('afterBegin','<div class="tab-proxy" style="position:absolute;visibility:visible;z-index:999;left:'+targetX+'px;"></div>',true);sliderWrapperEl.stripWrapper=sliderWrapperEl.insertHtml('afterBegin','<div class="x-tab-strip x-tab-strip-top"></div>',true);sliderWrapperEl.dragEl=sliderWrapperEl.stripWrapper.insertHtml('afterBegin','<div></div>',true);sliderWrapperEl.dragEl.update(target.dom.innerHTML);sliderWrapperEl.dragEl.dom.className=target.dom.className;var h=parseInt(target.getTop(false));sliderWrapperEl.setTop(h)
return sliderWrapperEl;},onDragDrop:function(e,targetId){e.stopEvent();},endDrag:function(e){var elX=this.tab.getX();this.proxyWrapper.applyStyles('visibility:visible;');this.proxyWrapper.shift({x:elX,easing:'easeOut',duration:this.slideDuration,callback:function(){this.proxyWrapper.applyStyles('visibility:hidden;');this.tab.applyStyles('visibility:visible;');this.stripWrap.remove();this.dragEl.remove();if(!this.targetProxy)
return;this.targetProxy.stripWrapper.remove();this.targetProxy.dragEl.remove();},scope:this});Ext.dd.DDM.useCache=true;}});Ext.reg('slidingtabpanel',Ext.ux.SlidingTabPanel);