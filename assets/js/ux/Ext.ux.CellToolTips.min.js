
Ext.ns('Ext.ux');Ext.ux.CellToolTips=function(config){var cfgTips;if(Ext.isArray(config)){cfgTips=config;config={};}
else{cfgTips=config.ajaxTips;}
Ext.ux.CellToolTips.superclass.constructor.call(this,config);if(config.tipConfig){this.tipConfig=config.tipConfig;}
this.ajaxTips=cfgTips;}
Ext.extend(Ext.ux.CellToolTips,Ext.util.Observable,{version:1.1,ajaxTips:false,tipTpls:false,tipFns:false,tipUrls:'',tipConfig:{},request:false,init:function(grid){if(!this.ajaxTips){return;}
this.tipTpls={};this.tipFns={};this.tipUrls={};Ext.each(this.ajaxTips,function(tip){this.tipTpls[tip.field]=new Ext.XTemplate(tip.tpl);if(tip.url){this.tipUrls[tip.field]=tip.url;if(tip.fn)
this.tipFns[tip.field]=tip.fn;}},this);delete(this.ajaxTips);grid.on('render',this.onGridRender.createDelegate(this));},setFieldTpl:function(fld,tpl){this.tipTpls[fld]=Ext.isObject(tpl)?tpl:new Ext.XTemplate(tpl);},onGridRender:function(grid){if(!this.tipTpls){return;}
Ext.apply(this.tipConfig,{target:grid.getView().mainBody,delegate:'.x-grid3-cell-inner',trackMouse:true,renderTo:document.body,finished:false});this.tip=new Ext.ToolTip(this.tipConfig);this.tip.ctt=this;this.tip.on('beforeshow',this.beforeTipShow.createDelegate(this.tip,[this,grid],true));this.tip.on('hide',this.hideTip);},beforeTipShow:function(tip,ctt,grid){var colIdx=grid.getView().findCellIndex(tip.triggerElement);var tipId=grid.getColumnModel().getDataIndex(colIdx);if(!ctt.tipTpls[tipId])
return false;if(!tip.finished){var isAjaxTip=(typeof ctt.tipUrls[tipId]=='string');var cellRec=grid.getStore().getAt(grid.getView().findRowIndex(tip.triggerElement));var data=cellRec.copy().data;if(isAjaxTip){ctt.loadDetails((ctt.tipFns[tipId])?ctt.tipFns[tipId](data):data,tip,grid,ctt,tipId);return false;}
else{tip.body.dom.innerHTML=ctt.tipTpls[tipId].apply(cellRec.data);}}
else{tip.body.dom.innerHTML=tip.ctt.tipTpls[tipId].apply(tip.tipdata);}},hideTip:function(tip){tip.finished=false;},loadDetails:function(data,tip,grid,ctt,tipid){Ext.Ajax.request({url:ctt.tipUrls[tipid],params:data,method:'POST',success:function(resp,opt){tip.finished=true;tip.tipdata=Ext.decode(resp.responseText);tip.show();}});}});